const translations = {
    en: {
        dashboard: "Dashboard",
        serviceOrders: "Service Orders",
        sales: "Sales",
        invoices: "Invoices",
        clients: "Clients",
        settings: "Settings",
        activeOrders: "Active Orders",
        resolved: "Resolved",
        pending: "Pending",
        monthlyRevenue: "Monthly Revenue",
        weeklyOverview: "Weekly Overview",
        statusDistribution: "Status Distribution",
        recentOrders: "Recent Orders",
        orderId: "Order ID",
        subject: "Subject",
        client: "Client",
        status: "Status",
        actions: "Actions",
        status_open: "Open",
        status_resolved: "Resolved",
        status_pending: "Pending",
        status_paid: "Paid",
        status_unpaid: "Unpaid",
        status_overdue: "Overdue",
        status_in_progress: "In Progress",
        status_completed: "Completed",
        notification_title: "New Notification",
        notification_body: "You have a new message from support.",
        viewAll: "View All",
        all: "All",
        newOrder: "New Order",
        newClient: "New Client",
        newSale: "New Sale",
        newInvoice: "New Invoice",
        cancel: "Cancel",
        save: "Save",
        orderCreated: "Order Created",
        orderCreatedMsg: "New service order has been successfully added.",
        clientCreated: "Client Created",
        clientCreatedMsg: "New client has been successfully added.",
        clientList: "Client List",
        salesHistory: "Sales History",
        invoicesList: "Invoices List",
        companyName: "Company Name",
        contactPerson: "Contact Person",
        email: "Email",
        device: "Device",
        date: "Date",
        total: "Total",
        saleId: "Sale ID",
        items: "Items",
        paymentMethod: "Payment",
        invoiceId: "Invoice #",
        issueDate: "Issue Date",
        dueDate: "Due Date",
        amount: "Amount",
        profileSettings: "Profile Settings",
        fullName: "Full Name",
        saveChanges: "Save Changes",
        appSettings: "App Settings",
        emailNotifications: "Email Notifications",
        emailNotifDesc: "Receive emails about new orders.",
        autoRefresh: "Auto Refresh",
        autoRefreshDesc: "Automatically refresh dashboard data.",
        welcomeBack: "Welcome Back",
        loginSubtitle: "Please enter your details to sign in.",
        password: "Password",
        signIn: "Sign In",
        loginSuccess: "Login Successful",
        loginSuccessMsg: "Welcome back, John Doe!",
        logout: "Logout",
        // New Service Order Translations
        clientData: "1. Client Data",
        needsDelivery: "Needs Delivery",
        deviceData: "2. Device Data",
        brand: "Brand",
        model: "Model",
        serial: "Serial",
        imei: "IMEI",
        color: "Color",
        capacity: "Capacity (GB)",
        security: "3. Security",
        patternLock: "Pattern Lock",
        clear: "Clear",
        services: "4. Services to be Performed",
        svc_budget: "Evaluation for budget",
        svc_screen: "Screen/Display Replacement",
        svc_glass: "Glass Replacement",
        svc_battery: "Battery Replacement",
        svc_charging: "Charging Port Replacement",
        svc_board: "Motherboard Repair",
        svc_cam_rear: "Rear Camera Replacement",
        svc_cam_front: "Front Camera Replacement",
        svc_speaker: "Speaker Replacement",
        svc_water: "Water Damage Repair",
        svc_software: "Software Update/Reset",
        svc_backup: "Backup & Data Transfer",
        svc_other: "Other Services",
        observations: "Additional Observations",
        chip: "5. Chip",
        withChip: "With Chip",
        withoutChip: "Without Chip",
        deadline: "6. Deadline",
        checklist: "7. Initial Checklist",
        wet: "Wet?",
        charging: "Charging?",
        turnsOn: "Turns On?",
        housingDamage: "Housing Damage?",
        media: "11. Photos & Videos",
        photoIn: "Photo - In",
        photoOut: "Photo - Out",
        budgetPayment: "14. Budget & Payment",
        serviceValue: "Service Value (R$)",
        productsValue: "Products Value (R$)",
        discount: "Discount (R$)",
        totalValue: "Total (R$)",
        printType: "Print Type",
        generateOrder: "Generate Service Order",
        inventory: "Inventory",
        expenses: "Expenses",
        inventoryList: "Inventory List",
        expensesList: "Expenses List",
        newItem: "New Item",
        newExpense: "New Expense",
        itemName: "Item Name",
        sku: "SKU",
        quantity: "Quantity",
        price: "Price",
        description: "Description",
        category: "Category",
        deleted: "Trash",
        restore: "Restore",
        details: "Details",
        close: "Close",
        edit: "Edit"
    },
    pt: {
        dashboard: "Painel",
        serviceOrders: "Ordens de ServiÃ§o",
        sales: "Vendas",
        invoices: "Notas Fiscais",
        clients: "Clientes",
        settings: "ConfiguraÃ§Ãµes",
        activeOrders: "OS Ativas",
        resolved: "Resolvidos",
        pending: "Pendentes",
        monthlyRevenue: "Receita Mensal",
        weeklyOverview: "VisÃ£o Semanal",
        statusDistribution: "DistribuiÃ§Ã£o de Status",
        recentOrders: "OS Recentes",
        orderId: "OS #",
        subject: "Assunto",
        client: "Cliente",
        status: "Status",
        actions: "AÃ§Ãµes",
        status_open: "Aberto",
        status_resolved: "Resolvido",
        status_pending: "Pendente",
        status_paid: "Pago",
        status_unpaid: "Pendente",
        status_overdue: "Atrasado",
        status_in_progress: "Em Andamento",
        status_completed: "ConcluÃ­do",
        notification_title: "Nova NotificaÃ§Ã£o",
        notification_body: "VocÃª tem uma nova mensagem do suporte.",
        viewAll: "Ver Todos",
        all: "Todos",
        newOrder: "Nova OS",
        newClient: "Novo Cliente",
        newSale: "Nova Venda",
        newInvoice: "Nova Nota",
        cancel: "Cancelar",
        save: "Salvar",
        orderCreated: "OS Criada",
        orderCreatedMsg: "Nova ordem de serviÃ§o adicionada com sucesso.",
        clientCreated: "Cliente Criado",
        clientCreatedMsg: "Novo cliente adicionado com sucesso.",
        clientList: "Lista de Clientes",
        salesHistory: "HistÃ³rico de Vendas",
        invoicesList: "Lista de Notas Fiscais",
        companyName: "Nome da Empresa",
        contactPerson: "Pessoa de Contato",
        email: "Email",
        device: "Dispositivo",
        date: "Data",
        total: "Total",
        saleId: "ID da Venda",
        items: "Itens",
        paymentMethod: "Pagamento",
        invoiceId: "Nota #",
        issueDate: "EmissÃ£o",
        dueDate: "Vencimento",
        amount: "Valor",
        profileSettings: "ConfiguraÃ§Ãµes de Perfil",
        fullName: "Nome Completo",
        saveChanges: "Salvar AlteraÃ§Ãµes",
        appSettings: "ConfiguraÃ§Ãµes do App",
        emailNotifications: "NotificaÃ§Ãµes por Email",
        emailNotifDesc: "Receber emails sobre novas OS.",
        autoRefresh: "AtualizaÃ§Ã£o AutomÃ¡tica",
        autoRefreshDesc: "Atualizar dados do painel automaticamente.",
        welcomeBack: "Bem-vindo de Volta",
        loginSubtitle: "Por favor, insira seus dados para entrar.",
        password: "Senha",
        signIn: "Entrar",
        loginSuccess: "Login com Sucesso",
        loginSuccessMsg: "Bem-vindo de volta, John Doe!",
        logout: "Sair",
        // New Service Order Translations
        clientData: "1. Dados do Cliente",
        needsDelivery: "Precisa de Entrega",
        deviceData: "2. Dados do Aparelho",
        brand: "Marca",
        model: "Modelo",
        serial: "Serial",
        imei: "IMEI",
        color: "Cor",
        capacity: "Capacidade (GB)",
        security: "3. SeguranÃ§a",
        patternLock: "PadrÃ£o de Desenho",
        clear: "Limpar",
        services: "4. ServiÃ§os a Serem Executados",
        svc_budget: "AvaliaÃ§Ã£o para orÃ§amento",
        svc_screen: "Troca de Tela/Display",
        svc_glass: "Troca de Vidro",
        svc_battery: "Troca de Bateria",
        svc_charging: "Troca de Conector de Carga",
        svc_board: "Reparo de Placa MÃ£e",
        svc_cam_rear: "Troca de CÃ¢mera Traseira",
        svc_cam_front: "Troca de CÃ¢mera Frontal",
        svc_speaker: "Troca de Alto-Falante",
        svc_water: "Reparo de Ãgua/OxidaÃ§Ã£o",
        svc_software: "AtualizaÃ§Ã£o de Software",
        svc_backup: "Backup e TransferÃªncia",
        svc_other: "Outros ServiÃ§os",
        observations: "ObservaÃ§Ãµes Adicionais",
        chip: "5. Chip",
        withChip: "Com Chip",
        withoutChip: "Sem Chip",
        deadline: "6. Prazo",
        checklist: "7. Checklist Inicial",
        wet: "JÃ¡ foi molhado?",
        charging: "EstÃ¡ carregando?",
        turnsOn: "Chegou ligando?",
        housingDamage: "Tem danos na carcaÃ§a?",
        media: "11. Fotos e VÃ­deos",
        photoIn: "Foto - Entrada",
        photoOut: "Foto - SaÃ­da",
        budgetPayment: "14. OrÃ§amento e Pagamento",
        serviceValue: "Valor do ServiÃ§o (R$)",
        productsValue: "Valor dos Produtos (R$)",
        discount: "Desconto (R$)",
        totalValue: "Valor Total (R$)",
        printType: "Tipo de ImpressÃ£o",
        generateOrder: "Gerar Ordem de ServiÃ§o",
        inventory: "Estoque",
        expenses: "Despesas",
        inventoryList: "Lista de Estoque",
        expensesList: "Lista de Despesas",
        newItem: "Novo Item",
        newExpense: "Nova Despesa",
        itemName: "Nome do Item",
        sku: "SKU",
        quantity: "Quantidade",
        price: "PreÃ§o",
        description: "DescriÃ§Ã£o",
        category: "Categoria",
        deleted: "Lixeira",
        restore: "Restaurar",
        details: "Detalhes",
        close: "Fechar",
        edit: "Editar"
    },
    // ... (Other languages would need updates too, but focusing on EN/PT for now as per user request context)
    es: {
        dashboard: "Tablero",
        serviceOrders: "Ã“rdenes de Servicio",
        sales: "Ventas",
        invoices: "Facturas",
        clients: "Clientes",
        settings: "Ajustes",
        activeOrders: "Ã“rdenes Activas",
        resolved: "Resueltos",
        pending: "Pendientes",
        monthlyRevenue: "Ingresos Mensuales",
        weeklyOverview: "Resumen Semanal",
        statusDistribution: "DistribuciÃ³n de Estado",
        recentOrders: "Ã“rdenes Recientes",
        orderId: "ID Orden",
        subject: "Asunto",
        client: "Cliente",
        status: "Estado",
        actions: "Acciones",
        status_open: "Abierto",
        status_resolved: "Resuelto",
        status_pending: "Pendiente",
        status_paid: "Pagado",
        status_unpaid: "Pendiente",
        status_overdue: "Vencido",
        status_in_progress: "En Progreso",
        status_completed: "Completado",
        notification_title: "Nueva NotificaciÃ³n",
        notification_body: "Tienes un nuevo mensaje de soporte.",
        viewAll: "Ver Todos",
        all: "Todos",
        newOrder: "Nueva Orden",
        newClient: "Nuevo Cliente",
        newSale: "Nueva Venta",
        newInvoice: "Nueva Factura",
        cancel: "Cancelar",
        save: "Guardar",
        orderCreated: "Orden Creada",
        orderCreatedMsg: "Nueva orden de servicio aÃ±adida con Ã©xito.",
        clientCreated: "Cliente Creado",
        clientCreatedMsg: "Nuevo cliente aÃ±adido con Ã©xito.",
        clientList: "Lista de Clientes",
        salesHistory: "Historial de Ventas",
        invoicesList: "Lista de Facturas",
        companyName: "Nombre de la Empresa",
        contactPerson: "Persona de Contacto",
        email: "Correo",
        device: "Dispositivo",
        date: "Fecha",
        total: "Total",
        saleId: "ID Venta",
        items: "ArtÃ­culos",
        paymentMethod: "Pago",
        invoiceId: "Factura #",
        issueDate: "EmisiÃ³n",
        dueDate: "Vencimiento",
        amount: "Monto",
        profileSettings: "Ajustes de Perfil",
        fullName: "Nombre Completo",
        saveChanges: "Guardar Cambios",
        appSettings: "Ajustes de la App",
        emailNotifications: "Notificaciones por Correo",
        emailNotifDesc: "Recibir correos sobre nuevas Ã³rdenes.",
        autoRefresh: "ActualizaciÃ³n AutomÃ¡tica",
        autoRefreshDesc: "Actualizar datos del tablero automÃ¡ticamente.",
        welcomeBack: "Bienvenido de Nuevo",
        loginSubtitle: "Por favor ingrese sus datos para iniciar sesiÃ³n.",
        password: "ContraseÃ±a",
        signIn: "Iniciar SesiÃ³n",
        loginSuccess: "Inicio de SesiÃ³n Exitoso",
        loginSuccessMsg: "Â¡Bienvenido de nuevo, John Doe!",
        logout: "Cerrar SesiÃ³n",
        // New Service Order Translations (Spanish placeholders)
        clientData: "1. Datos del Cliente",
        needsDelivery: "Necesita Entrega",
        deviceData: "2. Datos del Dispositivo",
        brand: "Marca",
        model: "Modelo",
        serial: "Serie",
        imei: "IMEI",
        color: "Color",
        capacity: "Capacidad (GB)",
        security: "3. Seguridad",
        patternLock: "PatrÃ³n de Bloqueo",
        clear: "Limpiar",
        services: "4. Servicios a Realizar",
        svc_budget: "EvaluaciÃ³n para presupuesto",
        svc_screen: "Reemplazo de Pantalla",
        svc_glass: "Reemplazo de Vidrio",
        svc_battery: "Reemplazo de BaterÃ­a",
        svc_charging: "Reemplazo de Puerto de Carga",
        svc_board: "ReparaciÃ³n de Placa Madre",
        svc_cam_rear: "Reemplazo de CÃ¡mara Trasera",
        svc_cam_front: "Reemplazo de CÃ¡mara Frontal",
        svc_speaker: "Reemplazo de Altavoz",
        svc_water: "ReparaciÃ³n de DaÃ±os por Agua",
        svc_software: "ActualizaciÃ³n de Software",
        svc_backup: "Copia de Seguridad",
        svc_other: "Otros Servicios",
        observations: "Observaciones Adicionales",
        chip: "5. Chip",
        withChip: "Con Chip",
        withoutChip: "Sin Chip",
        deadline: "6. Plazo",
        checklist: "7. Lista de VerificaciÃ³n",
        wet: "Â¿Mojado?",
        charging: "Â¿Cargando?",
        turnsOn: "Â¿Enciende?",
        housingDamage: "Â¿DaÃ±os en Carcasa?",
        media: "11. Fotos y Videos",
        photoIn: "Foto - Entrada",
        photoOut: "Foto - Salida",
        budgetPayment: "14. Presupuesto y Pago",
        serviceValue: "Valor del Servicio",
        productsValue: "Valor de Productos",
        discount: "Descuento",
        totalValue: "Valor Total",
        printType: "Tipo de ImpresiÃ³n",
        generateOrder: "Generar Orden"
    },
    fr: {
        dashboard: "Tableau de bord",
        serviceOrders: "Ordres de Service",
        sales: "Ventes",
        invoices: "Factures",
        clients: "Clients",
        settings: "ParamÃ¨tres",
        activeOrders: "Ordres Actifs",
        resolved: "RÃ©solus",
        pending: "En attente",
        monthlyRevenue: "Revenu Mensuel",
        weeklyOverview: "AperÃ§u Hebdomadaire",
        statusDistribution: "Distribution des Statuts",
        recentOrders: "Ordres RÃ©cents",
        orderId: "ID Ordre",
        subject: "Sujet",
        client: "Client",
        status: "Statut",
        actions: "Actions",
        status_open: "Ouvert",
        status_resolved: "RÃ©solu",
        status_pending: "En attente",
        status_paid: "PayÃ©",
        status_unpaid: "ImpayÃ©",
        status_overdue: "En retard",
        status_in_progress: "En cours",
        status_completed: "TerminÃ©",
        notification_title: "Nouvelle Notification",
        notification_body: "Vous avez un nouveau message du support.",
        viewAll: "Voir Tout",
        all: "Tous",
        newOrder: "Nouvel Ordre",
        newClient: "Nouveau Client",
        newSale: "Nouvelle Vente",
        newInvoice: "Nouvelle Facture",
        cancel: "Annuler",
        save: "Sauvegarder",
        orderCreated: "Ordre CrÃ©Ã©",
        orderCreatedMsg: "Nouvel ordre de service ajoutÃ© avec succÃ¨s.",
        clientCreated: "Client CrÃ©Ã©",
        clientCreatedMsg: "Nouveau client ajoutÃ© avec succÃ¨s.",
        clientList: "Liste des Clients",
        salesHistory: "Historique des Ventes",
        invoicesList: "Liste des Factures",
        companyName: "Nom de l'Entreprise",
        contactPerson: "Personne de Contact",
        email: "Email",
        device: "Appareil",
        date: "Date",
        total: "Total",
        saleId: "ID Vente",
        items: "Articles",
        paymentMethod: "Paiement",
        invoiceId: "Facture #",
        issueDate: "Ã‰mission",
        dueDate: "Ã‰chÃ©ance",
        amount: "Montant",
        profileSettings: "ParamÃ¨tres de Profil",
        fullName: "Nom Complet",
        saveChanges: "Sauvegarder les Modifications",
        appSettings: "ParamÃ¨tres de l'App",
        emailNotifications: "Notifications par Email",
        emailNotifDesc: "Recevoir des emails sur les nouveaux ordres.",
        autoRefresh: "Actualisation Automatique",
        autoRefreshDesc: "Actualiser automatiquement les donnÃ©es du tableau de bord.",
        welcomeBack: "Bienvenue",
        loginSubtitle: "Veuillez entrer vos coordonnÃ©es pour vous connecter.",
        password: "Mot de passe",
        signIn: "Se Connecter",
        loginSuccess: "Connexion RÃ©ussie",
        loginSuccessMsg: "Bienvenue, John Doe!",
        logout: "Se DÃ©connecter",
        // New Service Order Translations (French placeholders)
        clientData: "1. DonnÃ©es Client",
        needsDelivery: "Livraison NÃ©cessaire",
        deviceData: "2. DonnÃ©es Appareil",
        brand: "Marque",
        model: "ModÃ¨le",
        serial: "SÃ©rie",
        imei: "IMEI",
        color: "Couleur",
        capacity: "CapacitÃ© (Go)",
        security: "3. SÃ©curitÃ©",
        patternLock: "SchÃ©ma de Verrouillage",
        clear: "Effacer",
        services: "4. Services Ã  Effectuer",
        svc_budget: "Ã‰valuation pour devis",
        svc_screen: "Remplacement Ã‰cran",
        svc_glass: "Remplacement Vitre",
        svc_battery: "Remplacement Batterie",
        svc_charging: "Remplacement Port de Charge",
        svc_board: "RÃ©paration Carte MÃ¨re",
        svc_cam_rear: "Remplacement CamÃ©ra ArriÃ¨re",
        svc_cam_front: "Remplacement CamÃ©ra Avant",
        svc_speaker: "Remplacement Haut-parleur",
        svc_water: "RÃ©paration DÃ©gÃ¢ts des Eaux",
        svc_software: "Mise Ã  jour Logicielle",
        svc_backup: "Sauvegarde",
        svc_other: "Autres Services",
        observations: "Observations SupplÃ©mentaires",
        chip: "5. Puce",
        withChip: "Avec Puce",
        withoutChip: "Sans Puce",
        deadline: "6. DÃ©lai",
        checklist: "7. Liste de ContrÃ´le",
        wet: "MouillÃ©?",
        charging: "Charge?",
        turnsOn: "S'allume?",
        housingDamage: "Dommages BoÃ®tier?",
        media: "11. Photos et VidÃ©os",
        photoIn: "Photo - EntrÃ©e",
        photoOut: "Photo - Sortie",
        budgetPayment: "14. Budget et Paiement",
        serviceValue: "Valeur Service",
        productsValue: "Valeur Produits",
        discount: "Remise",
        totalValue: "Valeur Totale",
        printType: "Type d'Impression",
        generateOrder: "GÃ©nÃ©rer Ordre"
    },
    de: {
        dashboard: "Armaturenbrett",
        serviceOrders: "ServiceauftrÃ¤ge",
        sales: "VerkÃ¤ufe",
        invoices: "Rechnungen",
        clients: "Kunden",
        settings: "Einstellungen",
        activeOrders: "Aktive AuftrÃ¤ge",
        resolved: "GelÃ¶st",
        pending: "Ausstehend",
        monthlyRevenue: "Monatlicher Umsatz",
        weeklyOverview: "WochenÃ¼bersicht",
        statusDistribution: "Statusverteilung",
        recentOrders: "Neueste AuftrÃ¤ge",
        orderId: "Auftrags-ID",
        subject: "Betreff",
        client: "Kunde",
        status: "Status",
        actions: "Aktionen",
        status_open: "Offen",
        status_resolved: "GelÃ¶st",
        status_pending: "Ausstehend",
        status_paid: "Bezahlt",
        status_unpaid: "Unbezahlt",
        status_overdue: "ÃœberfÃ¤llig",
        status_in_progress: "In Bearbeitung",
        status_completed: "Abgeschlossen",
        notification_title: "Neue Benachrichtigung",
        notification_body: "Sie haben eine neue Nachricht vom Support.",
        viewAll: "Alle Ansehen",
        all: "Alle",
        newOrder: "Neuer Auftrag",
        newClient: "Neuer Kunde",
        newSale: "Neuer Verkauf",
        newInvoice: "Neue Rechnung",
        cancel: "Abbrechen",
        save: "Speichern",
        orderCreated: "Auftrag Erstellt",
        orderCreatedMsg: "Neuer Serviceauftrag erfolgreich hinzugefÃ¼gt.",
        clientCreated: "Kunde Erstellt",
        clientCreatedMsg: "Neuer Kunde erfolgreich hinzugefÃ¼gt.",
        clientList: "Kundenliste",
        salesHistory: "Verkaufshistorie",
        invoicesList: "Rechnungsliste",
        companyName: "Firmenname",
        contactPerson: "Kontaktperson",
        email: "Email",
        device: "GerÃ¤t",
        date: "Datum",
        total: "Gesamt",
        saleId: "Verkaufs-ID",
        items: "Artikel",
        paymentMethod: "Zahlung",
        invoiceId: "Rechnung #",
        issueDate: "Ausstellung",
        dueDate: "FÃ¤lligkeit",
        amount: "Betrag",
        profileSettings: "Profileinstellungen",
        fullName: "VollstÃ¤ndiger Name",
        saveChanges: "Ã„nderungen Speichern",
        appSettings: "App-Einstellungen",
        emailNotifications: "E-Mail-Benachrichtigungen",
        emailNotifDesc: "E-Mails Ã¼ber neue AuftrÃ¤ge erhalten.",
        autoRefresh: "Automatische Aktualisierung",
        autoRefreshDesc: "Dashboard-Daten automatisch aktualisieren.",
        welcomeBack: "Willkommen ZurÃ¼ck",
        loginSubtitle: "Bitte geben Sie Ihre Daten ein, um sich anzumelden.",
        password: "Passwort",
        signIn: "Anmelden",
        loginSuccess: "Anmeldung Erfolgreich",
        loginSuccessMsg: "Willkommen zurÃ¼ck, John Doe!",
        logout: "Abmelden",
        // New Service Order Translations (German placeholders)
        clientData: "1. Kundendaten",
        needsDelivery: "Lieferung Erforderlich",
        deviceData: "2. GerÃ¤tedaten",
        brand: "Marke",
        model: "Modell",
        serial: "Seriennummer",
        imei: "IMEI",
        color: "Farbe",
        capacity: "KapazitÃ¤t (GB)",
        security: "3. Sicherheit",
        patternLock: "Mustersperre",
        clear: "LÃ¶schen",
        services: "4. DurchzufÃ¼hrende Dienste",
        svc_budget: "Bewertung fÃ¼r Kostenvoranschlag",
        svc_screen: "Bildschirmtausch",
        svc_glass: "Glastausch",
        svc_battery: "Batterietausch",
        svc_charging: "Ladebuchsentausch",
        svc_board: "Mainboard-Reparatur",
        svc_cam_rear: "RÃ¼ckkameratausch",
        svc_cam_front: "Frontkameratausch",
        svc_speaker: "Lautsprechertausch",
        svc_water: "Wasserschadenreparatur",
        svc_software: "Software-Update",
        svc_backup: "Datensicherung",
        svc_other: "Andere Dienste",
        observations: "ZusÃ¤tzliche Beobachtungen",
        chip: "5. Chip",
        withChip: "Mit Chip",
        withoutChip: "Ohne Chip",
        deadline: "6. Frist",
        checklist: "7. Checkliste",
        wet: "Nass?",
        charging: "LÃ¤dt?",
        turnsOn: "Geht an?",
        housingDamage: "GehÃ¤useschaden?",
        media: "11. Fotos & Videos",
        photoIn: "Foto - Eingang",
        photoOut: "Foto - Ausgang",
        budgetPayment: "14. Budget & Zahlung",
        serviceValue: "Dienstleistungswert",
        productsValue: "Produktwert",
        discount: "Rabatt",
        totalValue: "Gesamtwert",
        printType: "Druckart",
        generateOrder: "Auftrag Generieren"
    }
};

// Data
// Data
let serviceOrders = [];
let clients = [];
let sales = [];
let invoices = [];
let inventory = [];
let expenses = [];

const today = new Date();
const formatDate = (d) => d.toISOString().split('T')[0];
const day = 86400000;

const defaultServiceOrders = [
    { id: "#SO-9823", subject: "Screen Replacement", client: "Acme Corp", status: "open", device: "iPhone 13", date: formatDate(today) },
    { id: "#SO-9822", subject: "Battery Issue", client: "Globex Inc", status: "resolved", device: "Samsung S21", date: formatDate(new Date(today.getTime() - day)) },
    { id: "#SO-9821", subject: "Water Damage", client: "Soylent Corp", status: "pending", device: "Xiaomi Mi 11", date: formatDate(new Date(today.getTime() - day * 2)) },
    { id: "#SO-9820", subject: "Software Reset", client: "Umbrella Corp", status: "resolved", device: "Motorola G100", date: formatDate(new Date(today.getTime() - day * 3)) },
    { id: "#SO-9819", subject: "Charging Port", client: "Cyberdyne", status: "open", device: "iPhone 12", date: formatDate(new Date(today.getTime() - day * 4)) },
    { id: "#SO-9818", subject: "Camera Lens", client: "Initech", status: "resolved", device: "Pixel 6", date: formatDate(new Date(today.getTime() - day * 5)) }
];

const defaultClients = [
    { name: "Acme Corp", contact: "Wile E. Coyote", email: "coyote@acme.com", tickets: 12 },
    { name: "Globex Inc", contact: "Hank Scorpio", email: "hank@globex.com", tickets: 5 },
    { name: "Soylent Corp", contact: "Richard Thornburg", email: "richard@soylent.com", tickets: 8 },
    { name: "Umbrella Corp", contact: "Albert Wesker", email: "albert@umbrella.com", tickets: 15 },
    { name: "Cyberdyne", contact: "Miles Dyson", email: "miles@cyberdyne.com", tickets: 3 }
];

const defaultSales = [
    { id: "#SL-5001", date: "2023-10-25", client: "Acme Corp", items: "Software License x5", total: "$2,500.00", payment: "Credit Card" },
    { id: "#SL-5002", date: "2023-10-24", client: "Umbrella Corp", items: "Security Audit", total: "$5,000.00", payment: "Bank Transfer" },
    { id: "#SL-5003", date: "2023-10-22", client: "Initech", items: "Consulting Hours x10", total: "$1,500.00", payment: "PayPal" }
];

const defaultInvoices = [
    { id: "#INV-2023-001", client: "Acme Corp", issueDate: "2023-10-01", dueDate: "2023-10-31", amount: "$2,500.00", status: "paid" },
    { id: "#INV-2023-002", client: "Umbrella Corp", issueDate: "2023-10-05", dueDate: "2023-11-05", amount: "$5,000.00", status: "unpaid" },
    { id: "#INV-2023-003", client: "Cyberdyne", issueDate: "2023-09-15", dueDate: "2023-10-15", amount: "$8,000.00", status: "overdue" }
];

const defaultInventory = [
    { id: 1, name: "iPhone 13 Screen", sku: "SCR-IP13", quantity: 5, price: 150.00 },
    { id: 2, name: "Samsung S21 Battery", sku: "BAT-S21", quantity: 10, price: 45.00 },
    { id: 3, name: "USB-C Cable", sku: "ACC-USBC", quantity: 50, price: 5.00 }
];

const defaultExpenses = [
    { id: 1, description: "Office Rent", category: "Rent", date: "2023-10-01", amount: 1200.00 },
    { id: 2, description: "Electricity Bill", category: "Utilities", date: "2023-10-05", amount: 150.00 },
    { id: 3, description: "Cleaning Supplies", category: "Supplies", date: "2023-10-10", amount: 50.00 }
];

// State
let currentLang = localStorage.getItem('lang') || 'en';
let isDarkMode = localStorage.getItem('theme') === 'dark';
let chartInstance = null;
let statusChartInstance = null;
let currentFilter = 'all';
let currentView = 'list'; // 'list' or 'board'

// Elements
const langSelector = document.getElementById('language-selector');
const themeToggle = document.getElementById('theme-toggle');
const themeIcon = themeToggle.querySelector('.icon');
const notificationBtn = document.getElementById('notification-btn');
const navItems = document.querySelectorAll('.nav-link');
const views = document.querySelectorAll('.view-section');
const pageTitle = document.getElementById('page-title');
const searchInput = document.getElementById('global-search');
const userMenuBtn = document.getElementById('user-menu-btn');
const userDropdown = document.getElementById('user-dropdown');
const logoutBtn = document.getElementById('logout-btn');

// Login Elements
const loginScreen = document.getElementById('login-screen');
const appMain = document.getElementById('app-main');
const loginForm = document.getElementById('login-form');

// View Toggles
const viewListBtn = document.getElementById('view-list-btn');
const viewBoardBtn = document.getElementById('view-board-btn');
const ordersListView = document.getElementById('orders-list-view');
const ordersBoardView = document.getElementById('orders-board-view');

// Modal Elements
const orderModal = document.getElementById('order-modal');
const clientModal = document.getElementById('client-modal');
const newOrderBtn = document.getElementById('new-order-btn');
const newClientBtn = document.getElementById('new-client-btn');
const closeModalBtns = document.querySelectorAll('.close-modal');
const newOrderForm = document.getElementById('new-order-form');
const newClientForm = document.getElementById('new-client-form');
const newItemForm = document.getElementById('new-item-form');
const newExpenseForm = document.getElementById('new-expense-form');

// Inventory & Expense Elements
const inventoryModal = document.getElementById('inventory-modal');
const expenseModal = document.getElementById('expense-modal');
const newItemBtn = document.getElementById('new-item-btn');
const newExpenseBtn = document.getElementById('new-expense-btn');

// Details Modal
const detailsModal = document.getElementById('details-modal');
const detailsContent = document.getElementById('details-content');
const detailsTitle = document.getElementById('details-title');

// New Order Form Elements
const orderClientSelect = document.getElementById('order-client');
const patternDots = document.querySelectorAll('.dot');
const clearPatternBtn = document.getElementById('clear-pattern');
const valService = document.getElementById('val-service');
const valProducts = document.getElementById('val-products');
const valDiscount = document.getElementById('val-discount');
const valTotal = document.getElementById('val-total');

// Initialize
async function init() {
    // Set initial language
    langSelector.value = currentLang;
    updateLanguage(currentLang);

    // Set initial theme
    if (isDarkMode) {
        document.body.classList.add('dark-mode');
        themeIcon.textContent = 'â˜€ï¸';
    } else {
        themeIcon.textContent = 'ğŸŒ™';
    }

    // Check Login Status
    if (localStorage.getItem('loggedIn') === 'true') {
        loginScreen.classList.add('hidden');
        appMain.classList.remove('hidden');

        // Load Data from API
        await loadData();

        // Initialize App Data
        updateStats();
        renderDashboardTable();
        renderOrdersTable();
        renderKanbanBoard();
        renderSales();
        renderInvoices();
        renderClients();
        renderInventory();
        renderExpenses();
        renderChart();
        renderStatusChart();
    }

    // Event Listeners
    setupEventListeners();
}

function setupEventListeners() {
    // Login
    loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        setTimeout(() => {
            localStorage.setItem('loggedIn', 'true');
            loginScreen.classList.add('hidden');
            appMain.classList.remove('hidden');

            // Initialize App Data
            updateStats();
            renderDashboardTable();
            renderOrdersTable();
            renderKanbanBoard();
            renderSales();
            renderInvoices();
            renderClients();
            renderInventory();
            renderExpenses();
            renderChart();
            renderStatusChart();

            const t = translations[currentLang];
            showToast(t.loginSuccess, t.loginSuccessMsg);
        }, 500);
    });

    // Logout
    logoutBtn.addEventListener('click', (e) => {
        e.preventDefault();
        localStorage.setItem('loggedIn', 'false');
        appMain.classList.add('hidden');
        loginScreen.classList.remove('hidden');
        userDropdown.classList.add('hidden');
    });

    // User Dropdown
    userMenuBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        userDropdown.classList.toggle('hidden');
    });

    document.addEventListener('click', () => {
        userDropdown.classList.add('hidden');
    });

    // Language
    langSelector.addEventListener('change', (e) => {
        currentLang = e.target.value;
        localStorage.setItem('lang', currentLang);
        updateLanguage(currentLang);
        renderDashboardTable();
        renderOrdersTable();
        renderKanbanBoard();
        renderSales();
        renderInvoices();
        renderClients();
        renderInventory();
        renderExpenses();
        renderChart();
        renderStatusChart();
    });

    // Theme
    themeToggle.addEventListener('click', () => {
        isDarkMode = !isDarkMode;
        document.body.classList.toggle('dark-mode');
        localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
        themeIcon.textContent = isDarkMode ? 'â˜€ï¸' : 'ğŸŒ™';
        renderChart();
        renderStatusChart();
    });

    // Navigation
    navItems.forEach(item => {
        item.addEventListener('click', (e) => {
            e.preventDefault();
            const target = item.getAttribute('data-view');

            // Update Active State
            navItems.forEach(nav => nav.classList.remove('active'));
            item.classList.add('active');

            // Show View
            views.forEach(view => view.classList.add('hidden'));
            const viewEl = document.getElementById(`view-${target}`);
            if (viewEl) {
                viewEl.classList.remove('hidden');
                viewEl.classList.add('fade-in');
            }

            // Update Title (if pageTitle exists, though it might not be in DOM)
            if (typeof pageTitle !== 'undefined' && pageTitle) {
                const t = translations[currentLang];
                pageTitle.textContent = t[target] || target;
                pageTitle.setAttribute('data-i18n', target);
            }
        });
    });

    // View All Button
    document.getElementById('view-all-orders-btn').addEventListener('click', () => {
        document.querySelector('[data-target="service-orders"]').click();
    });

    // Orders View Toggles
    viewListBtn.addEventListener('click', () => {
        currentView = 'list';
        viewListBtn.classList.add('active');
        viewBoardBtn.classList.remove('active');
        ordersListView.classList.remove('hidden');
        ordersBoardView.classList.add('hidden');
    });

    viewBoardBtn.addEventListener('click', () => {
        currentView = 'board';
        viewBoardBtn.classList.add('active');
        viewListBtn.classList.remove('active');
        ordersBoardView.classList.remove('hidden');
        ordersListView.classList.add('hidden');
        renderKanbanBoard();
    });

    // Search
    searchInput.addEventListener('input', (e) => {
        const term = e.target.value.toLowerCase();
        renderOrdersTable(term);
    });

    // Filters
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            currentFilter = btn.getAttribute('data-filter');
            renderOrdersTable(searchInput.value.toLowerCase());
        });
    });

    // Modals
    newOrderBtn.addEventListener('click', () => {
        populateClientSelect();
        orderModal.classList.remove('hidden');
    });

    newClientBtn.addEventListener('click', () => {
        clientModal.classList.remove('hidden');
    });

    closeModalBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            const modalId = btn.getAttribute('data-modal');
            document.getElementById(modalId).classList.add('hidden');
        });
    });

    window.addEventListener('click', (e) => {
        if (e.target.classList.contains('modal-overlay')) {
            e.target.classList.add('hidden');
        }
    });

    // Pattern Lock Logic
    patternDots.forEach(dot => {
        dot.addEventListener('click', () => {
            dot.classList.toggle('active');
        });
    });

    clearPatternBtn.addEventListener('click', () => {
        patternDots.forEach(dot => dot.classList.remove('active'));
    });

    // Calculation Logic
    const calculateTotal = () => {
        const service = parseFloat(valService.value) || 0;
        const products = parseFloat(valProducts.value) || 0;
        const discount = parseFloat(valDiscount.value) || 0;
        const total = service + products - discount;
        valTotal.value = total.toFixed(2);
    };

    valService.addEventListener('input', calculateTotal);
    valDiscount.addEventListener('input', calculateTotal);

    // Form Submit - Order
    // Form Submit - Order
    newOrderForm.addEventListener('submit', (e) => {
        e.preventDefault();

        // Gather Data
        const client = orderClientSelect.value;
        const brand = document.getElementById('device-brand').value;
        const model = document.getElementById('device-model').value;
        const subject = `${brand} ${model} Repair`; // Auto-generate subject based on device

        const newOrder = {
            id: `#SO-${Math.floor(Math.random() * 10000)}`,
            client,
            subject,
            status: 'open', // Default status
            device: `${brand} ${model}`,
            date: new Date().toISOString().split('T')[0]
        };

        serviceOrders.unshift(newOrder);
        saveData();

        updateStats();
        renderDashboardTable();
        renderOrdersTable();
        renderKanbanBoard();
        renderStatusChart();

        orderModal.classList.add('hidden');
        newOrderForm.reset();
        patternDots.forEach(dot => dot.classList.remove('active'));

        const t = translations[currentLang];
        showToast(t.orderCreated, t.orderCreatedMsg);
    });

    // Form Submit - Client
    newClientForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const name = document.getElementById('client-company').value;
        const contact = document.getElementById('client-contact').value;
        const email = document.getElementById('client-email').value;

        const newClient = {
            name,
            contact,
            email,
            tickets: 0
        };

        clients.push(newClient);
        saveData();
        renderClients();

        clientModal.classList.add('hidden');
        newClientForm.reset();

        const t = translations[currentLang];
        showToast(t.clientCreated, t.clientCreatedMsg);
    });

    // Notification
    notificationBtn.addEventListener('click', () => {
        const t = translations[currentLang];
        showToast(t.notification_title, t.notification_body);
    });

    // New Item Modal
    newItemBtn.addEventListener('click', () => {
        inventoryModal.classList.remove('hidden');
    });

    newItemForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const name = document.getElementById('item-name').value;
        const sku = document.getElementById('item-sku').value;
        const quantity = document.getElementById('item-quantity').value;
        const price = document.getElementById('item-price').value;

        const newItem = {
            id: Date.now(),
            name,
            sku,
            quantity: parseInt(quantity),
            price: parseFloat(price)
        };

        inventory.push(newItem);
        saveData();
        renderInventory();
        inventoryModal.classList.add('hidden');
        newItemForm.reset();
        showToast('Item Added', 'New inventory item added.');
    });

    // New Expense Modal
    newExpenseBtn.addEventListener('click', () => {
        expenseModal.classList.remove('hidden');
    });

    newExpenseForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const description = document.getElementById('expense-description').value;
        const category = document.getElementById('expense-category').value;
        const date = document.getElementById('expense-date').value;
        const amount = document.getElementById('expense-amount').value;

        const newExpense = {
            id: Date.now(),
            description,
            category,
            date,
            amount: parseFloat(amount)
        };

        expenses.push(newExpense);
        saveData();
        renderExpenses();
        expenseModal.classList.add('hidden');
        newExpenseForm.reset();
        showToast('Expense Added', 'New expense added.');
    });
}

function populateClientSelect() {
    orderClientSelect.innerHTML = `<option value="">Select client...</option>`;
    clients.forEach(client => {
        const option = document.createElement('option');
        option.value = client.name;
        option.textContent = client.name;
        orderClientSelect.appendChild(option);
    });
}

function updateStats() {
    const active = serviceOrders.filter(t => t.status === 'open').length;
    const resolved = serviceOrders.filter(t => t.status === 'resolved').length;
    const pending = serviceOrders.filter(t => t.status === 'pending').length;

    document.getElementById('stat-active').textContent = active;
    document.getElementById('stat-resolved').textContent = resolved;
    document.getElementById('stat-pending').textContent = pending;
}

function updateLanguage(lang) {
    const texts = translations[lang];
    document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        if (texts[key]) {
            element.textContent = texts[key];
        }
    });
}

function renderDashboardTable() {
    const tbody = document.getElementById('dashboard-table-body');
    tbody.innerHTML = '';
    const t = translations[currentLang];

    // Show only top 4
    serviceOrders.slice(0, 4).forEach(order => {
        const tr = document.createElement('tr');
        const statusLabel = t[`status_${order.status}`] || order.status;

        tr.innerHTML = `
            <td>${order.id}</td>
            <td>${order.subject}</td>
            <td>${order.client}</td>
            <td><span class="status-chip status-${order.status}">${statusLabel}</span></td>
        `;
        tbody.appendChild(tr);
    });
}

function renderKanbanBoard() {
    const columns = {
        open: document.getElementById('board-open'),
        pending: document.getElementById('board-pending'),
        resolved: document.getElementById('board-resolved')
    };

    const counts = {
        open: document.getElementById('count-open'),
        pending: document.getElementById('count-pending'),
        resolved: document.getElementById('count-resolved')
    };

    // Clear columns
    Object.values(columns).forEach(col => col.innerHTML = '');

    // Reset counts
    let countData = { open: 0, pending: 0, resolved: 0 };

    serviceOrders.forEach(order => {
        if (columns[order.status]) {
            countData[order.status]++;

            const card = document.createElement('div');
            card.className = 'kanban-card';
            card.draggable = true;
            card.setAttribute('data-id', order.id);
            card.innerHTML = `
                <div class="k-card-header">
                    <span>${order.id}</span>
                </div>
                <div class="k-card-title">${order.subject}</div>
                <div class="k-card-client">${order.client}</div>
            `;

            // Drag Events
            card.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('text/plain', order.id);
                e.target.classList.add('dragging');
            });

            card.addEventListener('dragend', (e) => {
                e.target.classList.remove('dragging');
            });

            columns[order.status].appendChild(card);
        }
    });

    // Update counts
    Object.keys(counts).forEach(key => {
        counts[key].textContent = countData[key];
    });

    // Drop Zones
    document.querySelectorAll('.kanban-column').forEach(column => {
        column.addEventListener('dragover', (e) => {
            e.preventDefault();
            column.style.backgroundColor = 'rgba(255,255,255,0.5)';
        });

        column.addEventListener('dragleave', (e) => {
            column.style.backgroundColor = 'rgba(255,255,255,0.3)';
        });

        column.addEventListener('drop', (e) => {
            e.preventDefault();
            column.style.backgroundColor = 'rgba(255,255,255,0.3)';
            const id = e.dataTransfer.getData('text/plain');
            const newStatus = column.getAttribute('data-status');

            // Update Order Status
            const order = serviceOrders.find(t => t.id === id);
            if (order && order.status !== newStatus) {
                order.status = newStatus;
                renderKanbanBoard();
                renderOrdersTable(); // Sync list view
                updateStats(); // Sync stats
                renderStatusChart(); // Sync chart
            }
        });
    });
}

function renderSales() {
    const tbody = document.getElementById('sales-table-body');
    tbody.innerHTML = '';

    sales.forEach(sale => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${sale.id}</td>
            <td>${sale.date}</td>
            <td>${sale.client}</td>
            <td>${sale.items}</td>
            <td>${sale.total}</td>
            <td>${sale.payment}</td>
            <td><button class="action-btn" onclick="viewDetails('sale', '${sale.id}')">ğŸ‘ï¸</button></td>
        `;
        tbody.appendChild(tr);
    });
}

function renderInvoices() {
    const tbody = document.getElementById('invoices-table-body');
    tbody.innerHTML = '';
    const t = translations[currentLang];

    invoices.forEach(inv => {
        const tr = document.createElement('tr');
        const statusLabel = t[`status_${inv.status}`] || inv.status;

        tr.innerHTML = `
            <td>${inv.id}</td>
            <td>${inv.client}</td>
            <td>${inv.issueDate}</td>
            <td>${inv.dueDate}</td>
            <td>${inv.amount}</td>
            <td><span class="status-chip status-${inv.status}">${statusLabel}</span></td>
            <td>
                <button class="action-btn" title="Download">â¬‡ï¸</button>
                <button class="action-btn" onclick="viewDetails('invoice', '${inv.id}')">ğŸ‘ï¸</button>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

function renderInventory() {
    const tbody = document.getElementById('inventory-table-body');
    tbody.innerHTML = '';
    const t = translations[currentLang];

    inventory.forEach(item => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${item.name}</td>
            <td>${item.sku}</td>
            <td>${item.quantity}</td>
            <td>$${item.price.toFixed(2)}</td>
            <td>
                <button class="action-btn">âœï¸</button>
                <button class="action-btn delete-btn">ğŸ—‘ï¸</button>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

function renderExpenses() {
    const tbody = document.getElementById('expenses-table-body');
    tbody.innerHTML = '';
    const t = translations[currentLang];

    expenses.forEach(exp => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${exp.description}</td>
            <td>${exp.category}</td>
            <td>${exp.date}</td>
            <td>$${exp.amount.toFixed(2)}</td>
            <td>
                <button class="action-btn delete-btn">ğŸ—‘ï¸</button>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

function renderClients() {
    const grid = document.getElementById('clients-grid');
    grid.innerHTML = '';
    const t = translations[currentLang];

    clients.forEach(client => {
        const card = document.createElement('div');
        card.className = 'client-card';
        card.style.cursor = 'pointer';
        card.onclick = () => editClient(client);
        card.innerHTML = `
            <div class="client-avatar">${client.name.charAt(0)}</div>
            <div class="client-info">
                <h3>${client.name}</h3>
                <p>${client.contact}</p>
                <p>${client.email}</p>
            </div>
            <div class="client-stats">
                <div class="client-stat">
                    <span>${client.tickets}</span>
                    <span>${t.tickets || 'Tickets'}</span>
                </div>
            </div>
        `;
        grid.appendChild(card);
    });
}

function renderChart() {
    const ctx = document.getElementById('ticketsChart').getContext('2d');
    const primaryColor = isDarkMode ? '#a29bfe' : '#6c5ce7';
    const textColor = isDarkMode ? '#dfe6e9' : '#2d3436';
    const gridColor = isDarkMode ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.05)';

    if (chartInstance) {
        chartInstance.destroy();
    }

    const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
    const today = new Date();
    const last7DaysLabels = [];
    const dataPoints = [];

    for (let i = 6; i >= 0; i--) {
        const d = new Date(today);
        d.setDate(today.getDate() - i);
        const dateString = d.toISOString().split('T')[0];
        last7DaysLabels.push(days[d.getDay()]);

        // Count orders for this date
        const count = serviceOrders.filter(o => o.date === dateString).length;
        dataPoints.push(count);
    }

    chartInstance = new Chart(ctx, {
        type: 'line',
        data: {
            labels: last7DaysLabels,
            datasets: [{
                label: translations[currentLang].serviceOrders,
                data: dataPoints,
                borderColor: primaryColor,
                backgroundColor: (context) => {
                    const ctx = context.chart.ctx;
                    const gradient = ctx.createLinearGradient(0, 0, 0, 400);
                    gradient.addColorStop(0, primaryColor + '80');
                    gradient.addColorStop(1, primaryColor + '00');
                    return gradient;
                },
                borderWidth: 3,
                tension: 0.4,
                fill: true,
                pointBackgroundColor: primaryColor,
                pointBorderColor: '#fff',
                pointBorderWidth: 2,
                pointRadius: 4,
                pointHoverRadius: 6
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: {
                    backgroundColor: isDarkMode ? '#2d3436' : '#fff',
                    titleColor: isDarkMode ? '#fff' : '#2d3436',
                    bodyColor: isDarkMode ? '#fff' : '#2d3436',
                    borderColor: gridColor,
                    borderWidth: 1,
                    padding: 10,
                    displayColors: false,
                    titleFont: { family: 'Outfit', size: 14 },
                    bodyFont: { family: 'Outfit', size: 14 }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: { color: gridColor, drawBorder: false },
                    ticks: { color: textColor, font: { family: 'Outfit' } }
                },
                x: {
                    grid: { display: false },
                    ticks: { color: textColor, font: { family: 'Outfit' } }
                }
            }
        }
    });
}

function renderStatusChart() {
    const ctx = document.getElementById('statusChart').getContext('2d');
    const textColor = isDarkMode ? '#dfe6e9' : '#2d3436';

    if (statusChartInstance) {
        statusChartInstance.destroy();
    }

    const active = serviceOrders.filter(t => t.status === 'open').length;
    const resolved = serviceOrders.filter(t => t.status === 'resolved').length;
    const pending = serviceOrders.filter(t => t.status === 'pending').length;

    statusChartInstance = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: [translations[currentLang].status_open, translations[currentLang].status_resolved, translations[currentLang].status_pending],
            datasets: [{
                data: [active, resolved, pending],
                backgroundColor: [
                    '#ff7675', // Danger/Open
                    '#00b894', // Success/Resolved
                    '#fdcb6e'  // Warning/Pending
                ],
                borderWidth: 0,
                hoverOffset: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        color: textColor,
                        font: { family: 'Outfit' },
                        usePointStyle: true,
                        padding: 20
                    }
                }
            },
            cutout: '70%'
        }
    });
}

function showToast(title, message) {
    const container = document.getElementById('toast-container');
    const toast = document.createElement('div');
    toast.className = 'toast';
    toast.innerHTML = `
        <div>
            <strong>${title}</strong>
            <p>${message}</p>
        </div>
    `;

    container.appendChild(toast);

    setTimeout(() => {
        toast.style.animation = 'slideOut 0.3s ease-in forwards';
        setTimeout(() => {
            toast.remove();
        }, 300);
    }, 3000);
}

// Data Persistence
async function loadData() {
    try {
        const [
            ordersData,
            clientsData,
            salesData,
            invoicesData,
            inventoryData,
            expensesData
        ] = await Promise.all([
            window.api.getOrders(),
            window.api.getClients(),
            window.api.getSales(),
            // Invoices not yet implemented in API fully, using empty array or mock
            Promise.resolve({ data: [] }),
            window.api.getInventory(),
            window.api.getExpenses()
        ]);

        serviceOrders = ordersData.data || [];
        clients = clientsData.data || [];
        sales = salesData.data || [];
        invoices = invoicesData.data || [];
        inventory = inventoryData.data || [];
        expenses = expensesData.data || [];

        console.log('Data loaded successfully from API');
    } catch (error) {
        console.error('Error loading data:', error);
        // Fallback to empty arrays or defaults if API fails
        serviceOrders = defaultServiceOrders;
        clients = defaultClients;
        sales = defaultSales;
        invoices = defaultInvoices;
        inventory = defaultInventory;
        expenses = defaultExpenses;
    }
}

function saveData() {
    localStorage.setItem('serviceOrders', JSON.stringify(serviceOrders));
    localStorage.setItem('clients', JSON.stringify(clients));
    localStorage.setItem('sales', JSON.stringify(sales));
    localStorage.setItem('invoices', JSON.stringify(invoices));
    localStorage.setItem('inventory', JSON.stringify(inventory));
    localStorage.setItem('expenses', JSON.stringify(expenses));
}

function deleteOrder(id) {
    const order = serviceOrders.find(o => o.id === id);
    if (order) {
        order.deleted = true;
        saveData();
        updateStats();
        renderDashboardTable();
        renderOrdersTable(searchInput.value.toLowerCase());
        renderKanbanBoard();
        renderStatusChart();
        renderChart();

        const t = translations[currentLang];
        showToast('Order Deleted', 'Moved to trash.');
    }
}

function restoreOrder(id) {
    const order = serviceOrders.find(o => o.id === id);
    if (order) {
        order.deleted = false;
        saveData();
        updateStats();
        renderDashboardTable();
        renderOrdersTable(searchInput.value.toLowerCase());
        renderKanbanBoard();
        renderStatusChart();
        renderChart();

        showToast('Order Restored', 'Order has been restored.');
    }
}

function editClient(client) {
    // Populate form
    document.getElementById('client-company').value = client.name;
    document.getElementById('client-contact').value = client.contact;
    document.getElementById('client-email').value = client.email;

    // Show modal
    clientModal.classList.remove('hidden');

    // Note: This is a simplified edit. Ideally we'd store the ID being edited and update on save.
    // For now, saving will create a new client. Implementing full edit requires refactoring save logic.
}

function viewDetails(type, id) {
    let content = '';
    let title = 'Details';

    if (type === 'order') {
        const order = serviceOrders.find(o => o.id === id);
        if (order) {
            title = `Order ${order.id}`;
            content = `
                <p><strong>Subject:</strong> ${order.subject}</p>
                <p><strong>Client:</strong> ${order.client}</p>
                <p><strong>Status:</strong> ${order.status}</p>
                <p><strong>Device:</strong> ${order.device}</p>
                <p><strong>Date:</strong> ${order.date}</p>
                <p><strong>Observations:</strong> ${order.observations || 'N/A'}</p>
            `;
        }
    } else if (type === 'sale') {
        const sale = sales.find(s => s.id === id);
        if (sale) {
            title = `Sale ${sale.id}`;
            content = `
                <p><strong>Date:</strong> ${sale.date}</p>
                <p><strong>Client:</strong> ${sale.client}</p>
                <p><strong>Items:</strong> ${sale.items}</p>
                <p><strong>Total:</strong> ${sale.total}</p>
                <p><strong>Payment:</strong> ${sale.payment}</p>
            `;
        }
    } else if (type === 'invoice') {
        const inv = invoices.find(i => i.id === id);
        if (inv) {
            title = `Invoice ${inv.id}`;
            content = `
                <p><strong>Client:</strong> ${inv.client}</p>
                <p><strong>Issue Date:</strong> ${inv.issueDate}</p>
                <p><strong>Due Date:</strong> ${inv.dueDate}</p>
                <p><strong>Amount:</strong> ${inv.amount}</p>
                <p><strong>Status:</strong> ${inv.status}</p>
            `;
        }
    }

    detailsTitle.textContent = title;
    detailsContent.innerHTML = content;
    detailsModal.classList.remove('hidden');
}

// ============================================
// ğŸ› ï¸ MISSING FUNCTIONS & FIXES
// ============================================

function renderOrdersTable(filterTerm = '') {
    const tbody = document.getElementById('orders-full-table-body');
    if (!tbody) return;

    tbody.innerHTML = '';
    const t = translations[currentLang];

    let filteredOrders = serviceOrders;

    // Filter by Search Term
    if (filterTerm) {
        filteredOrders = filteredOrders.filter(o =>
            o.client.toLowerCase().includes(filterTerm) ||
            o.id.toLowerCase().includes(filterTerm) ||
            o.device.toLowerCase().includes(filterTerm)
        );
    }

    // Filter by Status Tab
    if (currentFilter !== 'all') {
        filteredOrders = filteredOrders.filter(o => o.status === currentFilter);
    }

    // Sort by Date (Newest First)
    filteredOrders.sort((a, b) => new Date(b.date) - new Date(a.date));

    filteredOrders.forEach(order => {
        const tr = document.createElement('tr');
        const statusLabel = t[`status_${order.status}`] || order.status;

        tr.innerHTML = `
            <td>${order.id}</td>
            <td>
                <div style="font-weight:bold;">${order.subject}</div>
                <div style="font-size:0.85em; color:var(--text-secondary);">${order.device}</div>
            </td>
            <td>${order.client}</td>
            <td><span class="status-chip status-${order.status}">${statusLabel}</span></td>
            <td>
                <div class="action-buttons">
                    <button class="action-btn" onclick="viewDetails('order', '${order.id}')" title="${t.details}">ğŸ‘ï¸</button>
                    <button class="action-btn" onclick="printOrder('${order.id}', 'a4')" title="Print A4">ğŸ–¨ï¸ A4</button>
                    <button class="action-btn" onclick="printOrder('${order.id}', 'thermal')" title="Print Thermal">ğŸ§¾ 80mm</button>
                    <button class="action-btn delete-btn" onclick="deleteOrder('${order.id}')" title="${t.deleted}">ğŸ—‘ï¸</button>
                </div>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

// Initialize Pattern Lock when modal opens
// Note: We use a timeout to ensure DOM is ready if called immediately
document.addEventListener('DOMContentLoaded', () => {
    const btn = document.getElementById('new-order-btn');
    if (btn) {
        btn.addEventListener('click', () => {
            if (!window.patternLockInstance && window.PatternLock) {
                setTimeout(() => {
                    window.patternLockInstance = new PatternLock('pattern-lock-container', 'pattern-code');
                }, 100);
            } else if (window.patternLockInstance) {
                window.patternLockInstance.clear();
            }
        });
    }
});

// Run
init();
